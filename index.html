<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The Inverse Gamma Distribution • invgamma</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="The Inverse Gamma Distribution">
<meta name="description" content="Light weight implementation of the standard distribution functions for the inverse gamma distribution, wrapping those for the gamma distribution in the stats package.">
<meta property="og:description" content="Light weight implementation of the standard distribution functions for the inverse gamma distribution, wrapping those for the gamma distribution in the stats package.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">invgamma</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dkahle/invgamma/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="invgamma">
<strong>invgamma</strong><a class="anchor" aria-label="anchor" href="#invgamma"></a>
</h1></div>
<!-- badges: start -->

<p><strong>invgamma</strong> implements the <code>[dpqr]</code> statistics functions for the <a href="https://en.wikipedia.org/wiki/Inverse-gamma_distribution" class="external-link">inverse gamma distribution</a> in <a href="https://cran.r-project.org" class="external-link">R</a>. It is ideal for using in other packages since it is lightweight and leverages the <code>[dpqr]gamma()</code> line of functions maintained by CRAN.</p>
<p><em>Please see the section on parameterizations below to avoid any unintended mistakes!</em></p>
<div class="section level3">
<h3 id="getting-invgamma">Getting <strong>invgamma</strong>
<a class="anchor" aria-label="anchor" href="#getting-invgamma"></a>
</h3>
<p>There are two ways to get <strong>invgamma</strong>. For the <a href="https://cran.r-project.org/package=invgamma" class="external-link">CRAN version</a>, use</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"invgamma"</span><span class="op">)</span></span></code></pre></div>
<p>For the development version, use</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"dkahle/invgamma"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-dpqrinvgamma-functions">The <code>[dpqr]invgamma()</code> functions<a class="anchor" aria-label="anchor" href="#the-dpqrinvgamma-functions"></a>
</h3>
<p>The functions in <strong>invgamma</strong> match those for the gamma distribution provided by the <strong>stats</strong> package. Namely, it uses as its density <em>f(x) = (b^a / Gamma(a)) x^-(a+1) e^(-b/x),</em> where a = <code>shape</code> and b = <code>rate</code>.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Probability_density_function" class="external-link">PDF</a> (the <em>f(x)</em> above) can be evaluated with the <code><a href="reference/invgamma.html">dinvgamma()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/dkahle/invgamma" class="external-link">"invgamma"</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">.01</span><span class="op">)</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fl">7</span>; <span class="va">rate</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="reference/invgamma.html">dinvgamma</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-4-1.png"><!-- --></p>
<p>The <a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function" class="external-link">CDF</a> can be evaluated with the <code><a href="reference/invgamma.html">pinvgamma()</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="reference/invgamma.html">dinvgamma</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="va">f</span>, <span class="fl">0</span>, <span class="va">q</span><span class="op">)</span></span>
<span><span class="co">#  0.7621835 with absolute error &lt; 7.3e-05</span></span>
<span></span>
<span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invgamma.html">pinvgamma</a></span><span class="op">(</span><span class="va">q</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  [1] 0.7621835</span></span></code></pre></div>
<p>The <a href="https://en.wikipedia.org/wiki/Quantile_function" class="external-link">quantile function</a> can be evaluated with <code><a href="reference/invgamma.html">qinvgamma()</a></code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/invgamma.html">qinvgamma</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span> <span class="co"># = q</span></span>
<span><span class="co">#  [1] 2</span></span></code></pre></div>
<p>And random number generation can be performed with <code><a href="reference/invgamma.html">rinvgamma()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/invgamma.html">rinvgamma</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span></span>
<span><span class="co">#  [1] 2.640734 1.364965 1.342591 2.095975 1.273201</span></span></code></pre></div>
<p><code><a href="reference/invgamma.html">rinvgamma()</a></code> can be used to obtain a <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method" class="external-link">Monte Carlo</a> estimate of the probability given by <code><a href="reference/invgamma.html">pinvgamma()</a></code> above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e5</span></span>
<span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invgamma.html">rinvgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span> <span class="op">&lt;=</span> <span class="va">q</span><span class="op">)</span></span>
<span><span class="co">#  [1] 0.76401</span></span></code></pre></div>
<p>Moreover, we can check the consistency and correctness of the implementation with first a <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation" class="external-link">kernel density estimate</a>…</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu">f</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-9-1.png"><!-- --></p>
<p>…and also a <a href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot" class="external-link">quantile plot</a>…</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">qqplot</a></span><span class="op">(</span> <span class="st">"x"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ppoints.html" class="external-link">ppoints</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/invgamma.html">qinvgamma</a></span><span class="op">(</span><span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span>, <span class="st">"y"</span> <span class="op">=</span> <span class="va">draws</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Theoretical quantiles"</span>, ylab <span class="op">=</span> <span class="st">"Sample quantiles"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"QQ plot for inverse gamma draws"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-10-1.png"><!-- --></p>
<p>Both of these indicate that the samplers are consistent. As an inferential alternative, we can use a <a href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test" class="external-link">KS test</a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/ks.test.html" class="external-link">ks.test</a></span><span class="op">(</span></span>
<span>  <span class="va">draws</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="reference/invgamma.html">pinvgamma</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#  </span></span>
<span><span class="co">#   Asymptotic one-sample Kolmogorov-Smirnov test</span></span>
<span><span class="co">#  </span></span>
<span><span class="co">#  data:  draws</span></span>
<span><span class="co">#  D = 0.0029822, p-value = 0.3361</span></span>
<span><span class="co">#  alternative hypothesis: two-sided</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-dpqrinvchisq-and-dpqrinvexp-functions">The <code>[dpqr]invchisq()</code> and <code>[dpqr]invexp()</code> functions<a class="anchor" aria-label="anchor" href="#the-dpqrinvchisq-and-dpqrinvexp-functions"></a>
</h3>
<p>The <a href="https://en.wikipedia.org/wiki/Gamma_distribution" class="external-link">gamma distribution</a> subsumes the <a href="https://en.wikipedia.org/wiki/Chi-squared_distribution" class="external-link">chi-squared</a> and <a href="https://en.wikipedia.org/wiki/Exponential_distribution" class="external-link">exponential</a> <a href="https://en.wikipedia.org/wiki/Probability_distribution#Continuous_probability_distribution" class="external-link">distributions</a>, so it makes sense to include the <code>*invchisq()</code> and <code>*invexp()</code> functions in <strong>invgamma</strong>. Their implementations, however, wrap <code>*chisq()</code> and <code>*exp()</code>, not <code>*invgamma()</code>.</p>
</div>
<div class="section level3">
<h3 id="a-note-on-parameterizations">A note on parameterizations<a class="anchor" aria-label="anchor" href="#a-note-on-parameterizations"></a>
</h3>
<p>As detailed <a href="https://github.com/dkahle/invgamma/issues/1" class="external-link">here</a>, the parameterizations of the functions in this package cue off of their corresponding non-inverse distributions from <strong>stats</strong>. This commonly causes the confusion that, for example, the parameter <code>rate</code> in <code><a href="reference/invgamma.html">dinvgamma()</a></code> is the rate parameter of the inverse gamma distribution. It is not! It is the rate parameter of the corresponding gamma distribution. Please take care with this distinction.</p>
</div>
<div class="section level3">
<h3 id="a-note-on-numerics">A note on numerics<a class="anchor" aria-label="anchor" href="#a-note-on-numerics"></a>
</h3>
<p><strong>invgamma</strong> was intended to be a lightweight and simple, largely self-maintaining package implementing the inverse gamma, inverse chi-square, and inverse exponential distributions. It uses <a href="https://en.wikipedia.org/wiki/Random_variable#Functions_of_random_variables" class="external-link">the transformation theorem</a> in all cases.</p>
<p>One of the challenges to using naive implementations of distributions is that their <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic" class="external-link">numerics</a> may not work well. Arithmetic on a computer is not the same as arithmetic in theory, the kind that you meet in math classes, and as a consequence the best computer implementations of mathematical facts/algorithms need to be tailored to the specific cases at hand.</p>
<p>In January 2023 I did a little poking around into this for <code><a href="reference/invgamma.html">rinvgamma()</a></code> and found that it performs poorly when the shape parameter is less than .001 or so. The resulting distributions are very heavy-tailed, and the draws from these distributions returned by <code><a href="reference/invgamma.html">rinvgamma()</a></code> are so large that they get rounded to either very large numbers (where the floating point representation of numbers does not provide many numbers) or infinity. Here’s an example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/invgamma.html">rinvgamma</a></span><span class="op">(</span><span class="fl">10</span>, shape <span class="op">=</span> <span class="fl">.001</span>, rate <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#  Warning: `rinvgamma()` is unreliable for `shape` &lt;= .01.</span></span>
<span><span class="co">#   [1]           Inf           Inf 1.192692e+213           Inf 3.289218e+167</span></span>
<span><span class="co">#   [6]           Inf           Inf 7.899428e+197  3.938612e+97           Inf</span></span></code></pre></div>
<p>Notice that <code><a href="reference/invgamma.html">rinvgamma()</a></code> issues a warning in this circumstance; this is the general behavior of <strong>invgamma</strong>: if a particular parameter configuration is known to not produce valid results, a warning is issued.</p>
<div class="section level4">
<h4 id="ks-tests-for-sampling-accuracy">KS tests for sampling accuracy<a class="anchor" aria-label="anchor" href="#ks-tests-for-sampling-accuracy"></a>
</h4>
<div class="section level5">
<h5 id="rinvgamma">
<code>rinvgamma()</code><a class="anchor" aria-label="anchor" href="#rinvgamma"></a>
</h5>
<p>Here is a more detailed Monte Carlo investigation that checks sampler quality using <a href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test" class="external-link">the Kolmogorov-Smirnov test</a>.</p>
<p>First, we write a basic Monte Carlo test for the sampler that works by generating a large (<code>n = 1e6</code>) sample of draws from the inverse gamma distribution for a given shape and rate:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_invgamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shape</span>, <span class="va">rate</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invgamma.html">rinvgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/ks.test.html" class="external-link">ks.test</a></span><span class="op">(</span><span class="va">draws</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="reference/invgamma.html">pinvgamma</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">test_invgamma</span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#  [1] 0.3464601</span></span></code></pre></div>
<p>The function returns the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value associated with the KS test, so “small” values suggest a departure from the null hypothesis that the distribution is from the corresponding inverse gamma distribution: the sampler is performing poorly. Under the null hypothesis, <a href="https://en.wikipedia.org/wiki/P-value#p-value_as_the_statistic_for_performing_significance_tests" class="external-link">the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-value has an approximate uniform distribution</a>, a fact that can be found in most advanced mathematical statistics books, so we would expect some proportion to be small regardless.</p>
<p>We want to see the behavior of the sampler <code><a href="reference/invgamma.html">rinvgamma()</a></code> across a wide array of parameter values. To do this, we use a range of parameter values running from small (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>10</mn><mo>−</mo></msup><mn>4</mn></mrow><annotation encoding="application/x-tex">10^-4</annotation></semantics></math>) to large (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mn>4</mn></msup><annotation encoding="application/x-tex">10^4</annotation></semantics></math>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load tidyverse and related</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org" class="external-link">"tidyverse"</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://patchwork.data-imaginist.com" class="external-link">"patchwork"</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://scales.r-lib.org" class="external-link">"scales"</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">theme_set</span><span class="op">(</span><span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>; <span class="fu">theme_update</span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load furrr for parallel computing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/DavisVaughan/furrr" class="external-link">"furrr"</a></span><span class="op">)</span>; <span class="fu">furrr_options</span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#  &lt;furrr_options&gt;</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="fu">multisession</span><span class="op">(</span>workers <span class="op">=</span> <span class="fu">parallelly</span><span class="fu">::</span><span class="fu">availableCores</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set parameter values to test</span></span>
<span><span class="va">n_grid</span> <span class="op">&lt;-</span> <span class="fl">51</span></span>
<span><span class="va">param_vals</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="va">n_grid</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">param_grid</span> <span class="op">&lt;-</span> <span class="fu">expand_grid</span><span class="op">(</span><span class="st">"shape"</span> <span class="op">=</span> <span class="va">param_vals</span>, <span class="st">"rate"</span> <span class="op">=</span> <span class="va">param_vals</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  # A tibble: 2,601 × 2</span></span>
<span><span class="co">#      shape     rate</span></span>
<span><span class="co">#      &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#   1 0.0001 0.0001  </span></span>
<span><span class="co">#   2 0.0001 0.000145</span></span>
<span><span class="co">#   3 0.0001 0.000209</span></span>
<span><span class="co">#   4 0.0001 0.000302</span></span>
<span><span class="co">#   5 0.0001 0.000437</span></span>
<span><span class="co">#   6 0.0001 0.000631</span></span>
<span><span class="co">#   7 0.0001 0.000912</span></span>
<span><span class="co">#   8 0.0001 0.00132 </span></span>
<span><span class="co">#   9 0.0001 0.00191 </span></span>
<span><span class="co">#  10 0.0001 0.00275 </span></span>
<span><span class="co">#  # ℹ 2,591 more rows</span></span></code></pre></div>
<p>Here’s what the experiment’s design space looks like:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make axes labeller</span></span>
<span><span class="va">fmt</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu">math_format</span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="va">.x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">param_grid</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">shape</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span><span class="st">"title"</span> <span class="op">=</span> <span class="st">"Parameter Values at Which to Test `rinvgamma()`"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-15-1.png"><!-- --></p>
<p>Now, we run our test for each point in the design space in parallel. (Note: we’ve suppressed warnings here that are relevant.)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param_grid</span> <span class="op">&lt;-</span> <span class="va">param_grid</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>p_val <span class="op">=</span> <span class="fu">future_map2_dbl</span><span class="op">(</span><span class="va">shape</span>, <span class="va">rate</span>, <span class="va">test_invgamma</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And we visualize the distribution of the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values over that space, binning the colors to at .05 to highlight the rejections of the tests at the 5% level:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">param_grid</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">shape</span>, <span class="va">rate</span>, color <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_binned</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.05</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"p value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span><span class="st">"title"</span> <span class="op">=</span> <span class="st">"KS GoF Test of Draws for Different Parameter Values"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-17-1.png"><!-- --></p>
<p>If the sampler were working correctly, the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>-values would be approximately IID uniform(0,1), so we would expect about 5% of the points to be purple, and those 5% would be uniformly distributed over the whole space with no patterns. Obviously, that’s not the case: when the shape parameter is small, the test is always rejecting. Clearly, when <code>shape</code> is small, the sampler does not work well. Further investigations reveal that, as an easy rule, the sampler can be considered unreliable for <code>shape</code> values less than <code>0.01</code>. As a consequence, <code><a href="reference/invgamma.html">rinvgamma()</a></code> issues a warning in those circumstances. (This warning has been suppressed in the above computations.)</p>
</div>
<div class="section level5">
<h5 id="rinvchisq-and-rinvexp">
<code>rinvchisq()</code> and <code>rinvexp()</code>
<a class="anchor" aria-label="anchor" href="#rinvchisq-and-rinvexp"></a>
</h5>
<p>Similar investigations using the inverse chi-squared and inverse exponential reveal that <code><a href="reference/invchisq.html">rinvchisq()</a></code> should not be trusted when <code>df &lt;= .01</code> and <code>ncp &lt;= 10</code> and <code><a href="reference/invexp.html">rinvexp()</a></code> is trustworthy for all values. Here is the illustration for the inverse chi-squared:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_rinvchisq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">ncp</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invchisq.html">rinvchisq</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">df</span>, <span class="va">ncp</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/ks.test.html" class="external-link">ks.test</a></span><span class="op">(</span><span class="va">draws</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="reference/invchisq.html">pinvchisq</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">df</span>, <span class="va">ncp</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">expand_grid</span><span class="op">(</span><span class="st">"df"</span> <span class="op">=</span> <span class="va">param_vals</span>, <span class="st">"ncp"</span> <span class="op">=</span> <span class="va">param_vals</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="st">"p_val"</span> <span class="op">=</span> <span class="fu">future_map2_dbl</span><span class="op">(</span><span class="va">df</span>, <span class="va">ncp</span>, <span class="va">test_rinvchisq</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">df</span>, <span class="va">ncp</span>, color <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">nu</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_y_log10</span><span class="op">(</span><span class="st">"ncp"</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_binned</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.05</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"p value"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-18-1.png"><!-- --></p>
<p>And here is the illustration for the inverse exponential:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_rinvexp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rate</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">1e5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/invexp.html">rinvexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="va">rate</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/ks.test.html" class="external-link">ks.test</a></span><span class="op">(</span><span class="va">draws</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="reference/invexp.html">pinvexp</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">rate</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="op">(</span><span class="st">"rate"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">n_grid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span><span class="st">"p_val"</span> <span class="op">=</span> <span class="fu">future_map_dbl</span><span class="op">(</span><span class="va">rate</span>, <span class="va">test_rinvexp</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">rate</span>, <span class="fl">0</span>, color <span class="op">=</span> <span class="va">p_val</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_x_log10</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">10</span>, labels <span class="op">=</span> <span class="fu">fmt</span><span class="op">(</span><span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">scale_color_binned</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.05</span>, <span class="fl">1</span><span class="op">)</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">coord_equal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tools/README-unnamed-chunk-19-1.png"><!-- --></p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=invgamma" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/dkahle/invgamma/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/dkahle/invgamma/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing invgamma</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>David Kahle <br><small class="roles"> Author, maintainer, copyright holder </small>   </li>
<li>James Stamey <br><small class="roles"> Author, copyright holder </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://app.codecov.io/gh/dkahle/invgamma" class="external-link"><img src="https://codecov.io/gh/dkahle/invgamma/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Kahle, James Stamey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
